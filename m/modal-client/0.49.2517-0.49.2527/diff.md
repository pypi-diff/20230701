# Comparing `tmp/modal_client-0.49.2517-py3-none-any.whl.zip` & `tmp/modal_client-0.49.2527-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,166 +1,166 @@
-Zip file size: 265759 bytes, number of entries: 164
--rw-r--r--  2.0 unx       28 b- defN 23-Jun-30 21:27 client_test/__init__.py
--rw-r--r--  2.0 unx      392 b- defN 23-Jun-30 21:27 client_test/aio_test.py
--rw-r--r--  2.0 unx     5409 b- defN 23-Jun-30 21:27 client_test/async_utils_test.py
--rw-r--r--  2.0 unx     1474 b- defN 23-Jun-30 21:27 client_test/blob_test.py
--rw-r--r--  2.0 unx     3979 b- defN 23-Jun-30 21:27 client_test/cli_imports_test.py
--rw-r--r--  2.0 unx    14029 b- defN 23-Jun-30 21:27 client_test/cli_test.py
--rw-r--r--  2.0 unx     4768 b- defN 23-Jun-30 21:27 client_test/client_test.py
--rw-r--r--  2.0 unx     4422 b- defN 23-Jun-30 21:27 client_test/cls_test.py
--rw-r--r--  2.0 unx     2622 b- defN 23-Jun-30 21:27 client_test/config_test.py
--rw-r--r--  2.0 unx    32707 b- defN 23-Jun-30 21:27 client_test/conftest.py
--rw-r--r--  2.0 unx     4555 b- defN 23-Jun-30 21:27 client_test/container_app_test.py
--rw-r--r--  2.0 unx    24810 b- defN 23-Jun-30 21:27 client_test/container_test.py
--rw-r--r--  2.0 unx      405 b- defN 23-Jun-30 21:27 client_test/cpu_test.py
--rw-r--r--  2.0 unx     1086 b- defN 23-Jun-30 21:27 client_test/deprecation_test.py
--rw-r--r--  2.0 unx     2182 b- defN 23-Jun-30 21:27 client_test/e2e_test.py
--rw-r--r--  2.0 unx      165 b- defN 23-Jun-30 21:27 client_test/error_test.py
--rw-r--r--  2.0 unx      964 b- defN 23-Jun-30 21:27 client_test/function_serialization_test.py
--rw-r--r--  2.0 unx    16957 b- defN 23-Jun-30 21:27 client_test/function_test.py
--rw-r--r--  2.0 unx     3924 b- defN 23-Jun-30 21:27 client_test/gpu_test.py
--rw-r--r--  2.0 unx     5047 b- defN 23-Jun-30 21:27 client_test/grpc_utils_test.py
--rw-r--r--  2.0 unx      930 b- defN 23-Jun-30 21:27 client_test/helpers.py
--rw-r--r--  2.0 unx    15884 b- defN 23-Jun-30 21:27 client_test/image_test.py
--rw-r--r--  2.0 unx     2356 b- defN 23-Jun-30 21:27 client_test/live_reload_test.py
--rw-r--r--  2.0 unx     2619 b- defN 23-Jun-30 21:27 client_test/lookup_test.py
--rw-r--r--  2.0 unx     5317 b- defN 23-Jun-30 21:27 client_test/mount_test.py
--rw-r--r--  2.0 unx     6239 b- defN 23-Jun-30 21:27 client_test/mounted_files_test.py
--rw-r--r--  2.0 unx     2157 b- defN 23-Jun-30 21:27 client_test/notebook_test.py
--rw-r--r--  2.0 unx     1394 b- defN 23-Jun-30 21:27 client_test/object_test.py
--rw-r--r--  2.0 unx      413 b- defN 23-Jun-30 21:27 client_test/package_utils_test.py
--rw-r--r--  2.0 unx     1690 b- defN 23-Jun-30 21:27 client_test/resolver_test.py
--rw-r--r--  2.0 unx     1807 b- defN 23-Jun-30 21:27 client_test/retries_test.py
--rw-r--r--  2.0 unx     3143 b- defN 23-Jun-30 21:27 client_test/runner_test.py
--rw-r--r--  2.0 unx      359 b- defN 23-Jun-30 21:27 client_test/schedule_test.py
--rw-r--r--  2.0 unx     1185 b- defN 23-Jun-30 21:27 client_test/secret_test.py
--rw-r--r--  2.0 unx     1086 b- defN 23-Jun-30 21:27 client_test/serialization_test.py
--rw-r--r--  2.0 unx     3872 b- defN 23-Jun-30 21:27 client_test/shared_volume_test.py
--rw-r--r--  2.0 unx     8096 b- defN 23-Jun-30 21:27 client_test/stub_test.py
--rw-r--r--  2.0 unx     2691 b- defN 23-Jun-30 21:27 client_test/utils_test.py
--rw-r--r--  2.0 unx      410 b- defN 23-Jun-30 21:27 client_test/version_test.py
--rw-r--r--  2.0 unx     2174 b- defN 23-Jun-30 21:27 client_test/volume_test.py
--rw-r--r--  2.0 unx     1160 b- defN 23-Jun-30 21:27 client_test/watcher_test.py
--rw-r--r--  2.0 unx     3637 b- defN 23-Jun-30 21:27 client_test/webhook_test.py
--rw-r--r--  2.0 unx     1083 b- defN 23-Jun-30 21:27 modal/__init__.py
--rw-r--r--  2.0 unx      157 b- defN 23-Jun-30 21:27 modal/__main__.py
--rw-r--r--  2.0 unx     2106 b- defN 23-Jun-30 21:27 modal/_asgi.py
--rw-r--r--  2.0 unx    13413 b- defN 23-Jun-30 21:27 modal/_blob_utils.py
--rw-r--r--  2.0 unx    26319 b- defN 23-Jun-30 21:27 modal/_container_entrypoint.py
--rw-r--r--  2.0 unx    10990 b- defN 23-Jun-30 21:27 modal/_function_utils.py
--rw-r--r--  2.0 unx      450 b- defN 23-Jun-30 21:27 modal/_ipython.py
--rw-r--r--  2.0 unx      929 b- defN 23-Jun-30 21:27 modal/_location.py
--rw-r--r--  2.0 unx      850 b- defN 23-Jun-30 21:27 modal/_object_meta.py
--rw-r--r--  2.0 unx    17381 b- defN 23-Jun-30 21:27 modal/_output.py
--rw-r--r--  2.0 unx     1785 b- defN 23-Jun-30 21:27 modal/_proxy_tunnel.py
--rw-r--r--  2.0 unx     5043 b- defN 23-Jun-30 21:27 modal/_pty.py
--rw-r--r--  2.0 unx     5538 b- defN 23-Jun-30 21:27 modal/_resolver.py
--rw-r--r--  2.0 unx     1863 b- defN 23-Jun-30 21:27 modal/_serialization.py
--rw-r--r--  2.0 unx     7598 b- defN 23-Jun-30 21:27 modal/_traceback.py
--rw-r--r--  2.0 unx     1995 b- defN 23-Jun-30 21:27 modal/_tracing.py
--rw-r--r--  2.0 unx      490 b- defN 23-Jun-30 21:27 modal/_types.py
--rw-r--r--  2.0 unx     3409 b- defN 23-Jun-30 21:27 modal/_watcher.py
--rw-r--r--  2.0 unx      703 b- defN 23-Jun-30 21:27 modal/aio.py
--rw-r--r--  2.0 unx    11467 b- defN 23-Jun-30 21:27 modal/app.py
--rw-r--r--  2.0 unx     6300 b- defN 23-Jun-30 21:28 modal/app.pyi
--rw-r--r--  2.0 unx     2462 b- defN 23-Jun-30 21:27 modal/call_graph.py
--rw-r--r--  2.0 unx     9162 b- defN 23-Jun-30 21:27 modal/client.py
--rw-r--r--  2.0 unx     3429 b- defN 23-Jun-30 21:28 modal/client.pyi
--rw-r--r--  2.0 unx     1737 b- defN 23-Jun-30 21:27 modal/cls.py
--rw-r--r--  2.0 unx     7149 b- defN 23-Jun-30 21:27 modal/config.py
--rw-r--r--  2.0 unx     5962 b- defN 23-Jun-30 21:27 modal/dict.py
--rw-r--r--  2.0 unx     3538 b- defN 23-Jun-30 21:28 modal/dict.pyi
--rw-r--r--  2.0 unx     2750 b- defN 23-Jun-30 21:27 modal/exception.py
--rw-r--r--  2.0 unx    60540 b- defN 23-Jun-30 21:27 modal/functions.py
--rw-r--r--  2.0 unx    17872 b- defN 23-Jun-30 21:28 modal/functions.pyi
--rw-r--r--  2.0 unx     4995 b- defN 23-Jun-30 21:27 modal/gpu.py
--rw-r--r--  2.0 unx    49355 b- defN 23-Jun-30 21:27 modal/image.py
--rw-r--r--  2.0 unx    15261 b- defN 23-Jun-30 21:28 modal/image.pyi
--rw-r--r--  2.0 unx    15356 b- defN 23-Jun-30 21:27 modal/mount.py
--rw-r--r--  2.0 unx     5782 b- defN 23-Jun-30 21:28 modal/mount.pyi
--rw-r--r--  2.0 unx    13440 b- defN 23-Jun-30 21:27 modal/object.py
--rw-r--r--  2.0 unx     8240 b- defN 23-Jun-30 21:28 modal/object.pyi
--rw-r--r--  2.0 unx      623 b- defN 23-Jun-30 21:27 modal/proxy.py
--rw-r--r--  2.0 unx      625 b- defN 23-Jun-30 21:28 modal/proxy.pyi
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-30 21:27 modal/py.typed
--rw-r--r--  2.0 unx     5496 b- defN 23-Jun-30 21:27 modal/queue.py
--rw-r--r--  2.0 unx     2793 b- defN 23-Jun-30 21:28 modal/queue.pyi
--rw-r--r--  2.0 unx      502 b- defN 23-Jun-30 21:27 modal/requirements.txt
--rw-r--r--  2.0 unx     3730 b- defN 23-Jun-30 21:27 modal/retries.py
--rw-r--r--  2.0 unx     9446 b- defN 23-Jun-30 21:27 modal/runner.py
--rw-r--r--  2.0 unx     2619 b- defN 23-Jun-30 21:27 modal/schedule.py
--rw-r--r--  2.0 unx     5078 b- defN 23-Jun-30 21:27 modal/secret.py
--rw-r--r--  2.0 unx      765 b- defN 23-Jun-30 21:28 modal/secret.pyi
--rw-r--r--  2.0 unx     4717 b- defN 23-Jun-30 21:27 modal/serving.py
--rw-r--r--  2.0 unx     8227 b- defN 23-Jun-30 21:27 modal/shared_volume.py
--rw-r--r--  2.0 unx     3394 b- defN 23-Jun-30 21:28 modal/shared_volume.pyi
--rw-r--r--  2.0 unx    30645 b- defN 23-Jun-30 21:27 modal/stub.py
--rw-r--r--  2.0 unx    14482 b- defN 23-Jun-30 21:28 modal/stub.pyi
--rw-r--r--  2.0 unx     4332 b- defN 23-Jun-30 21:27 modal/volume.py
--rw-r--r--  2.0 unx      838 b- defN 23-Jun-30 21:28 modal/volume.pyi
--rw-r--r--  2.0 unx       28 b- defN 23-Jun-30 21:27 modal/cli/__init__.py
--rw-r--r--  2.0 unx     3206 b- defN 23-Jun-30 21:27 modal/cli/app.py
--rw-r--r--  2.0 unx     1373 b- defN 23-Jun-30 21:27 modal/cli/config.py
--rw-r--r--  2.0 unx     1882 b- defN 23-Jun-30 21:27 modal/cli/entry_point.py
--rw-r--r--  2.0 unx     3769 b- defN 23-Jun-30 21:27 modal/cli/environment.py
--rw-r--r--  2.0 unx    10552 b- defN 23-Jun-30 21:27 modal/cli/import_refs.py
--rw-r--r--  2.0 unx      700 b- defN 23-Jun-30 21:27 modal/cli/profile.py
--rw-r--r--  2.0 unx     9600 b- defN 23-Jun-30 21:27 modal/cli/run.py
--rw-r--r--  2.0 unx     4177 b- defN 23-Jun-30 21:27 modal/cli/secret.py
--rw-r--r--  2.0 unx     3085 b- defN 23-Jun-30 21:27 modal/cli/token.py
--rw-r--r--  2.0 unx      313 b- defN 23-Jun-30 21:27 modal/cli/utils.py
--rw-r--r--  2.0 unx    10599 b- defN 23-Jun-30 21:27 modal/cli/volume.py
--rw-r--r--  2.0 unx       28 b- defN 23-Jun-30 21:27 modal/extensions/__init__.py
--rw-r--r--  2.0 unx      987 b- defN 23-Jun-30 21:27 modal/extensions/ipython.py
--rw-r--r--  2.0 unx     6221 b- defN 23-Jun-30 21:27 modal/extensions/pymc.py
--rw-r--r--  2.0 unx       28 b- defN 23-Jun-30 21:27 modal_base_images/__init__.py
--rw-r--r--  2.0 unx      730 b- defN 23-Jun-30 21:27 modal_base_images/client_mount.py
--rw-r--r--  2.0 unx      324 b- defN 23-Jun-30 21:27 modal_base_images/conda.py
--rw-r--r--  2.0 unx      330 b- defN 23-Jun-30 21:27 modal_base_images/debian_slim.py
--rw-r--r--  2.0 unx      329 b- defN 23-Jun-30 21:27 modal_base_images/micromamba.py
--rw-r--r--  2.0 unx       28 b- defN 23-Jun-30 21:27 modal_proto/__init__.py
--rw-r--r--  2.0 unx    28852 b- defN 23-Jun-30 21:27 modal_proto/api.proto
--rw-r--r--  2.0 unx    48299 b- defN 23-Jun-30 21:27 modal_proto/api_grpc.py
--rw-r--r--  2.0 unx   119312 b- defN 23-Jun-30 21:27 modal_proto/api_pb2.py
--rw-r--r--  2.0 unx   104399 b- defN 23-Jun-30 21:27 modal_proto/api_pb2_grpc.py
--rw-r--r--  2.0 unx       28 b- defN 23-Jun-30 21:27 modal_test_support/__init__.py
--rw-r--r--  2.0 unx      134 b- defN 23-Jun-30 21:27 modal_test_support/assert_package.py
--rw-r--r--  2.0 unx      171 b- defN 23-Jun-30 21:27 modal_test_support/consumed_map.py
--rw-r--r--  2.0 unx     3013 b- defN 23-Jun-30 21:27 modal_test_support/functions.py
--rw-r--r--  2.0 unx      183 b- defN 23-Jun-30 21:27 modal_test_support/hello.py
--rw-r--r--  2.0 unx      266 b- defN 23-Jun-30 21:27 modal_test_support/image_run_function.py
--rw-r--r--  2.0 unx      180 b- defN 23-Jun-30 21:27 modal_test_support/is_inside.py
--rw-r--r--  2.0 unx      187 b- defN 23-Jun-30 21:27 modal_test_support/missing_main_conditional.py
--rw-r--r--  2.0 unx       59 b- defN 23-Jun-30 21:27 modal_test_support/module_1.py
--rw-r--r--  2.0 unx       59 b- defN 23-Jun-30 21:27 modal_test_support/module_2.py
--rw-r--r--  2.0 unx      277 b- defN 23-Jun-30 21:27 modal_test_support/multistub.py
--rw-r--r--  2.0 unx      228 b- defN 23-Jun-30 21:27 modal_test_support/multistub_is_inside.py
--rw-r--r--  2.0 unx      222 b- defN 23-Jun-30 21:27 modal_test_support/multistub_is_inside_warning.py
--rw-r--r--  2.0 unx      269 b- defN 23-Jun-30 21:27 modal_test_support/multistub_privately_decorated.py
--rw-r--r--  2.0 unx      211 b- defN 23-Jun-30 21:27 modal_test_support/multistub_privately_decorated_named_stub.py
--rw-r--r--  2.0 unx      218 b- defN 23-Jun-30 21:27 modal_test_support/multistub_same_name.py
--rw-r--r--  2.0 unx      219 b- defN 23-Jun-30 21:27 modal_test_support/multistub_serialized_func.py
--rw-r--r--  2.0 unx      197 b- defN 23-Jun-30 21:27 modal_test_support/package_mount.py
--rw-r--r--  2.0 unx      171 b- defN 23-Jun-30 21:27 modal_test_support/progress_info.py
--rw-r--r--  2.0 unx      153 b- defN 23-Jun-30 21:27 modal_test_support/script.py
--rw-r--r--  2.0 unx      178 b- defN 23-Jun-30 21:27 modal_test_support/startup_failure.py
--rw-r--r--  2.0 unx      177 b- defN 23-Jun-30 21:27 modal_test_support/stub.py
--rw-r--r--  2.0 unx      144 b- defN 23-Jun-30 21:27 modal_test_support/unconsumed_map.py
--rw-r--r--  2.0 unx      123 b- defN 23-Jun-30 21:27 modal_test_support/webhook_forgot_function.py
--rw-r--r--  2.0 unx       28 b- defN 23-Jun-30 21:27 modal_utils/__init__.py
--rw-r--r--  2.0 unx      465 b- defN 23-Jun-30 21:27 modal_utils/app_utils.py
--rw-r--r--  2.0 unx    11060 b- defN 23-Jun-30 21:27 modal_utils/async_utils.py
--rw-r--r--  2.0 unx     4641 b- defN 23-Jun-30 21:27 modal_utils/grpc_testing.py
--rw-r--r--  2.0 unx     9320 b- defN 23-Jun-30 21:27 modal_utils/grpc_utils.py
--rw-r--r--  2.0 unx     1597 b- defN 23-Jun-30 21:27 modal_utils/hash_utils.py
--rw-r--r--  2.0 unx     1426 b- defN 23-Jun-30 21:27 modal_utils/http_utils.py
--rw-r--r--  2.0 unx      113 b- defN 23-Jun-30 21:27 modal_utils/logger.py
--rw-r--r--  2.0 unx     1226 b- defN 23-Jun-30 21:27 modal_utils/package_utils.py
--rw-r--r--  2.0 unx      458 b- defN 23-Jun-30 21:27 modal_version/__init__.py
--rw-r--r--  2.0 unx       48 b- defN 23-Jun-30 21:27 modal_version/_version_generated.py
--rw-r--r--  2.0 unx    10173 b- defN 23-Jun-30 21:28 modal_client-0.49.2517.dist-info/LICENSE
--rw-r--r--  2.0 unx     1923 b- defN 23-Jun-30 21:28 modal_client-0.49.2517.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-30 21:28 modal_client-0.49.2517.dist-info/WHEEL
--rw-r--r--  2.0 unx       46 b- defN 23-Jun-30 21:28 modal_client-0.49.2517.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       93 b- defN 23-Jun-30 21:28 modal_client-0.49.2517.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    13337 b- defN 23-Jun-30 21:28 modal_client-0.49.2517.dist-info/RECORD
-164 files, 1066019 bytes uncompressed, 245087 bytes compressed:  77.0%
+Zip file size: 266490 bytes, number of entries: 164
+-rw-r--r--  2.0 unx       28 b- defN 23-Jul-01 06:10 client_test/__init__.py
+-rw-r--r--  2.0 unx      392 b- defN 23-Jul-01 06:10 client_test/aio_test.py
+-rw-r--r--  2.0 unx     5409 b- defN 23-Jul-01 06:10 client_test/async_utils_test.py
+-rw-r--r--  2.0 unx     1474 b- defN 23-Jul-01 06:10 client_test/blob_test.py
+-rw-r--r--  2.0 unx     3979 b- defN 23-Jul-01 06:10 client_test/cli_imports_test.py
+-rw-r--r--  2.0 unx    15086 b- defN 23-Jul-01 06:10 client_test/cli_test.py
+-rw-r--r--  2.0 unx     4768 b- defN 23-Jul-01 06:10 client_test/client_test.py
+-rw-r--r--  2.0 unx     4422 b- defN 23-Jul-01 06:10 client_test/cls_test.py
+-rw-r--r--  2.0 unx     2622 b- defN 23-Jul-01 06:10 client_test/config_test.py
+-rw-r--r--  2.0 unx    32707 b- defN 23-Jul-01 06:10 client_test/conftest.py
+-rw-r--r--  2.0 unx     4555 b- defN 23-Jul-01 06:10 client_test/container_app_test.py
+-rw-r--r--  2.0 unx    24810 b- defN 23-Jul-01 06:10 client_test/container_test.py
+-rw-r--r--  2.0 unx      405 b- defN 23-Jul-01 06:10 client_test/cpu_test.py
+-rw-r--r--  2.0 unx     1086 b- defN 23-Jul-01 06:10 client_test/deprecation_test.py
+-rw-r--r--  2.0 unx     2182 b- defN 23-Jul-01 06:10 client_test/e2e_test.py
+-rw-r--r--  2.0 unx      165 b- defN 23-Jul-01 06:10 client_test/error_test.py
+-rw-r--r--  2.0 unx      964 b- defN 23-Jul-01 06:10 client_test/function_serialization_test.py
+-rw-r--r--  2.0 unx    16957 b- defN 23-Jul-01 06:10 client_test/function_test.py
+-rw-r--r--  2.0 unx     3924 b- defN 23-Jul-01 06:10 client_test/gpu_test.py
+-rw-r--r--  2.0 unx     5047 b- defN 23-Jul-01 06:10 client_test/grpc_utils_test.py
+-rw-r--r--  2.0 unx      930 b- defN 23-Jul-01 06:10 client_test/helpers.py
+-rw-r--r--  2.0 unx    15884 b- defN 23-Jul-01 06:10 client_test/image_test.py
+-rw-r--r--  2.0 unx     2356 b- defN 23-Jul-01 06:10 client_test/live_reload_test.py
+-rw-r--r--  2.0 unx     2619 b- defN 23-Jul-01 06:10 client_test/lookup_test.py
+-rw-r--r--  2.0 unx     5317 b- defN 23-Jul-01 06:10 client_test/mount_test.py
+-rw-r--r--  2.0 unx     6239 b- defN 23-Jul-01 06:10 client_test/mounted_files_test.py
+-rw-r--r--  2.0 unx     2157 b- defN 23-Jul-01 06:10 client_test/notebook_test.py
+-rw-r--r--  2.0 unx     1394 b- defN 23-Jul-01 06:10 client_test/object_test.py
+-rw-r--r--  2.0 unx      413 b- defN 23-Jul-01 06:10 client_test/package_utils_test.py
+-rw-r--r--  2.0 unx     1690 b- defN 23-Jul-01 06:10 client_test/resolver_test.py
+-rw-r--r--  2.0 unx     1807 b- defN 23-Jul-01 06:10 client_test/retries_test.py
+-rw-r--r--  2.0 unx     2428 b- defN 23-Jul-01 06:10 client_test/runner_test.py
+-rw-r--r--  2.0 unx      359 b- defN 23-Jul-01 06:10 client_test/schedule_test.py
+-rw-r--r--  2.0 unx     1185 b- defN 23-Jul-01 06:10 client_test/secret_test.py
+-rw-r--r--  2.0 unx     1086 b- defN 23-Jul-01 06:10 client_test/serialization_test.py
+-rw-r--r--  2.0 unx     3872 b- defN 23-Jul-01 06:10 client_test/shared_volume_test.py
+-rw-r--r--  2.0 unx     8096 b- defN 23-Jul-01 06:10 client_test/stub_test.py
+-rw-r--r--  2.0 unx     2691 b- defN 23-Jul-01 06:10 client_test/utils_test.py
+-rw-r--r--  2.0 unx      410 b- defN 23-Jul-01 06:10 client_test/version_test.py
+-rw-r--r--  2.0 unx     2174 b- defN 23-Jul-01 06:10 client_test/volume_test.py
+-rw-r--r--  2.0 unx     1160 b- defN 23-Jul-01 06:10 client_test/watcher_test.py
+-rw-r--r--  2.0 unx     3637 b- defN 23-Jul-01 06:10 client_test/webhook_test.py
+-rw-r--r--  2.0 unx     1083 b- defN 23-Jul-01 06:10 modal/__init__.py
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-01 06:10 modal/__main__.py
+-rw-r--r--  2.0 unx     2106 b- defN 23-Jul-01 06:10 modal/_asgi.py
+-rw-r--r--  2.0 unx    13413 b- defN 23-Jul-01 06:10 modal/_blob_utils.py
+-rw-r--r--  2.0 unx    26319 b- defN 23-Jul-01 06:10 modal/_container_entrypoint.py
+-rw-r--r--  2.0 unx    10990 b- defN 23-Jul-01 06:10 modal/_function_utils.py
+-rw-r--r--  2.0 unx      450 b- defN 23-Jul-01 06:10 modal/_ipython.py
+-rw-r--r--  2.0 unx      929 b- defN 23-Jul-01 06:10 modal/_location.py
+-rw-r--r--  2.0 unx      850 b- defN 23-Jul-01 06:10 modal/_object_meta.py
+-rw-r--r--  2.0 unx    17381 b- defN 23-Jul-01 06:10 modal/_output.py
+-rw-r--r--  2.0 unx     1785 b- defN 23-Jul-01 06:10 modal/_proxy_tunnel.py
+-rw-r--r--  2.0 unx     5043 b- defN 23-Jul-01 06:10 modal/_pty.py
+-rw-r--r--  2.0 unx     5538 b- defN 23-Jul-01 06:10 modal/_resolver.py
+-rw-r--r--  2.0 unx     1863 b- defN 23-Jul-01 06:10 modal/_serialization.py
+-rw-r--r--  2.0 unx     7598 b- defN 23-Jul-01 06:10 modal/_traceback.py
+-rw-r--r--  2.0 unx     1995 b- defN 23-Jul-01 06:10 modal/_tracing.py
+-rw-r--r--  2.0 unx      490 b- defN 23-Jul-01 06:10 modal/_types.py
+-rw-r--r--  2.0 unx     3409 b- defN 23-Jul-01 06:10 modal/_watcher.py
+-rw-r--r--  2.0 unx      703 b- defN 23-Jul-01 06:10 modal/aio.py
+-rw-r--r--  2.0 unx    11467 b- defN 23-Jul-01 06:10 modal/app.py
+-rw-r--r--  2.0 unx     6300 b- defN 23-Jul-01 06:11 modal/app.pyi
+-rw-r--r--  2.0 unx     2462 b- defN 23-Jul-01 06:10 modal/call_graph.py
+-rw-r--r--  2.0 unx     9162 b- defN 23-Jul-01 06:10 modal/client.py
+-rw-r--r--  2.0 unx     3429 b- defN 23-Jul-01 06:11 modal/client.pyi
+-rw-r--r--  2.0 unx     1737 b- defN 23-Jul-01 06:10 modal/cls.py
+-rw-r--r--  2.0 unx     7149 b- defN 23-Jul-01 06:10 modal/config.py
+-rw-r--r--  2.0 unx     5962 b- defN 23-Jul-01 06:10 modal/dict.py
+-rw-r--r--  2.0 unx     3538 b- defN 23-Jul-01 06:11 modal/dict.pyi
+-rw-r--r--  2.0 unx     2750 b- defN 23-Jul-01 06:10 modal/exception.py
+-rw-r--r--  2.0 unx    60540 b- defN 23-Jul-01 06:10 modal/functions.py
+-rw-r--r--  2.0 unx    17872 b- defN 23-Jul-01 06:11 modal/functions.pyi
+-rw-r--r--  2.0 unx     4995 b- defN 23-Jul-01 06:10 modal/gpu.py
+-rw-r--r--  2.0 unx    49355 b- defN 23-Jul-01 06:10 modal/image.py
+-rw-r--r--  2.0 unx    15261 b- defN 23-Jul-01 06:11 modal/image.pyi
+-rw-r--r--  2.0 unx    15356 b- defN 23-Jul-01 06:10 modal/mount.py
+-rw-r--r--  2.0 unx     5782 b- defN 23-Jul-01 06:11 modal/mount.pyi
+-rw-r--r--  2.0 unx    13440 b- defN 23-Jul-01 06:10 modal/object.py
+-rw-r--r--  2.0 unx     8240 b- defN 23-Jul-01 06:11 modal/object.pyi
+-rw-r--r--  2.0 unx      623 b- defN 23-Jul-01 06:10 modal/proxy.py
+-rw-r--r--  2.0 unx      625 b- defN 23-Jul-01 06:11 modal/proxy.pyi
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-01 06:10 modal/py.typed
+-rw-r--r--  2.0 unx     5496 b- defN 23-Jul-01 06:10 modal/queue.py
+-rw-r--r--  2.0 unx     2793 b- defN 23-Jul-01 06:11 modal/queue.pyi
+-rw-r--r--  2.0 unx      502 b- defN 23-Jul-01 06:10 modal/requirements.txt
+-rw-r--r--  2.0 unx     3730 b- defN 23-Jul-01 06:10 modal/retries.py
+-rw-r--r--  2.0 unx     9446 b- defN 23-Jul-01 06:10 modal/runner.py
+-rw-r--r--  2.0 unx     2619 b- defN 23-Jul-01 06:10 modal/schedule.py
+-rw-r--r--  2.0 unx     5078 b- defN 23-Jul-01 06:10 modal/secret.py
+-rw-r--r--  2.0 unx      765 b- defN 23-Jul-01 06:11 modal/secret.pyi
+-rw-r--r--  2.0 unx     4717 b- defN 23-Jul-01 06:10 modal/serving.py
+-rw-r--r--  2.0 unx     8227 b- defN 23-Jul-01 06:10 modal/shared_volume.py
+-rw-r--r--  2.0 unx     3394 b- defN 23-Jul-01 06:11 modal/shared_volume.pyi
+-rw-r--r--  2.0 unx    30645 b- defN 23-Jul-01 06:10 modal/stub.py
+-rw-r--r--  2.0 unx    14482 b- defN 23-Jul-01 06:11 modal/stub.pyi
+-rw-r--r--  2.0 unx     4332 b- defN 23-Jul-01 06:10 modal/volume.py
+-rw-r--r--  2.0 unx      838 b- defN 23-Jul-01 06:11 modal/volume.pyi
+-rw-r--r--  2.0 unx       28 b- defN 23-Jul-01 06:10 modal/cli/__init__.py
+-rw-r--r--  2.0 unx     3206 b- defN 23-Jul-01 06:10 modal/cli/app.py
+-rw-r--r--  2.0 unx     1373 b- defN 23-Jul-01 06:10 modal/cli/config.py
+-rw-r--r--  2.0 unx     1882 b- defN 23-Jul-01 06:10 modal/cli/entry_point.py
+-rw-r--r--  2.0 unx     3769 b- defN 23-Jul-01 06:10 modal/cli/environment.py
+-rw-r--r--  2.0 unx    10552 b- defN 23-Jul-01 06:10 modal/cli/import_refs.py
+-rw-r--r--  2.0 unx      700 b- defN 23-Jul-01 06:10 modal/cli/profile.py
+-rw-r--r--  2.0 unx     9600 b- defN 23-Jul-01 06:10 modal/cli/run.py
+-rw-r--r--  2.0 unx     4177 b- defN 23-Jul-01 06:10 modal/cli/secret.py
+-rw-r--r--  2.0 unx     3085 b- defN 23-Jul-01 06:10 modal/cli/token.py
+-rw-r--r--  2.0 unx      313 b- defN 23-Jul-01 06:10 modal/cli/utils.py
+-rw-r--r--  2.0 unx    10599 b- defN 23-Jul-01 06:10 modal/cli/volume.py
+-rw-r--r--  2.0 unx       28 b- defN 23-Jul-01 06:10 modal/extensions/__init__.py
+-rw-r--r--  2.0 unx      987 b- defN 23-Jul-01 06:10 modal/extensions/ipython.py
+-rw-r--r--  2.0 unx     6221 b- defN 23-Jul-01 06:10 modal/extensions/pymc.py
+-rw-r--r--  2.0 unx       28 b- defN 23-Jul-01 06:10 modal_base_images/__init__.py
+-rw-r--r--  2.0 unx      730 b- defN 23-Jul-01 06:10 modal_base_images/client_mount.py
+-rw-r--r--  2.0 unx      324 b- defN 23-Jul-01 06:10 modal_base_images/conda.py
+-rw-r--r--  2.0 unx      330 b- defN 23-Jul-01 06:10 modal_base_images/debian_slim.py
+-rw-r--r--  2.0 unx      329 b- defN 23-Jul-01 06:10 modal_base_images/micromamba.py
+-rw-r--r--  2.0 unx       28 b- defN 23-Jul-01 06:10 modal_proto/__init__.py
+-rw-r--r--  2.0 unx    28852 b- defN 23-Jul-01 06:10 modal_proto/api.proto
+-rw-r--r--  2.0 unx    48299 b- defN 23-Jul-01 06:11 modal_proto/api_grpc.py
+-rw-r--r--  2.0 unx   119312 b- defN 23-Jul-01 06:11 modal_proto/api_pb2.py
+-rw-r--r--  2.0 unx   104399 b- defN 23-Jul-01 06:11 modal_proto/api_pb2_grpc.py
+-rw-r--r--  2.0 unx       28 b- defN 23-Jul-01 06:10 modal_test_support/__init__.py
+-rw-r--r--  2.0 unx      134 b- defN 23-Jul-01 06:10 modal_test_support/assert_package.py
+-rw-r--r--  2.0 unx      171 b- defN 23-Jul-01 06:10 modal_test_support/consumed_map.py
+-rw-r--r--  2.0 unx     3013 b- defN 23-Jul-01 06:10 modal_test_support/functions.py
+-rw-r--r--  2.0 unx      183 b- defN 23-Jul-01 06:10 modal_test_support/hello.py
+-rw-r--r--  2.0 unx      266 b- defN 23-Jul-01 06:10 modal_test_support/image_run_function.py
+-rw-r--r--  2.0 unx      180 b- defN 23-Jul-01 06:10 modal_test_support/is_inside.py
+-rw-r--r--  2.0 unx      187 b- defN 23-Jul-01 06:10 modal_test_support/missing_main_conditional.py
+-rw-r--r--  2.0 unx       59 b- defN 23-Jul-01 06:10 modal_test_support/module_1.py
+-rw-r--r--  2.0 unx       59 b- defN 23-Jul-01 06:10 modal_test_support/module_2.py
+-rw-r--r--  2.0 unx      277 b- defN 23-Jul-01 06:10 modal_test_support/multistub.py
+-rw-r--r--  2.0 unx      228 b- defN 23-Jul-01 06:10 modal_test_support/multistub_is_inside.py
+-rw-r--r--  2.0 unx      222 b- defN 23-Jul-01 06:10 modal_test_support/multistub_is_inside_warning.py
+-rw-r--r--  2.0 unx      269 b- defN 23-Jul-01 06:10 modal_test_support/multistub_privately_decorated.py
+-rw-r--r--  2.0 unx      211 b- defN 23-Jul-01 06:10 modal_test_support/multistub_privately_decorated_named_stub.py
+-rw-r--r--  2.0 unx      218 b- defN 23-Jul-01 06:10 modal_test_support/multistub_same_name.py
+-rw-r--r--  2.0 unx      219 b- defN 23-Jul-01 06:10 modal_test_support/multistub_serialized_func.py
+-rw-r--r--  2.0 unx      197 b- defN 23-Jul-01 06:10 modal_test_support/package_mount.py
+-rw-r--r--  2.0 unx      171 b- defN 23-Jul-01 06:10 modal_test_support/progress_info.py
+-rw-r--r--  2.0 unx      153 b- defN 23-Jul-01 06:10 modal_test_support/script.py
+-rw-r--r--  2.0 unx      178 b- defN 23-Jul-01 06:10 modal_test_support/startup_failure.py
+-rw-r--r--  2.0 unx      177 b- defN 23-Jul-01 06:10 modal_test_support/stub.py
+-rw-r--r--  2.0 unx      144 b- defN 23-Jul-01 06:10 modal_test_support/unconsumed_map.py
+-rw-r--r--  2.0 unx      123 b- defN 23-Jul-01 06:10 modal_test_support/webhook_forgot_function.py
+-rw-r--r--  2.0 unx       28 b- defN 23-Jul-01 06:10 modal_utils/__init__.py
+-rw-r--r--  2.0 unx      465 b- defN 23-Jul-01 06:10 modal_utils/app_utils.py
+-rw-r--r--  2.0 unx    11060 b- defN 23-Jul-01 06:10 modal_utils/async_utils.py
+-rw-r--r--  2.0 unx     6538 b- defN 23-Jul-01 06:10 modal_utils/grpc_testing.py
+-rw-r--r--  2.0 unx     9320 b- defN 23-Jul-01 06:10 modal_utils/grpc_utils.py
+-rw-r--r--  2.0 unx     1597 b- defN 23-Jul-01 06:10 modal_utils/hash_utils.py
+-rw-r--r--  2.0 unx     1426 b- defN 23-Jul-01 06:10 modal_utils/http_utils.py
+-rw-r--r--  2.0 unx      113 b- defN 23-Jul-01 06:10 modal_utils/logger.py
+-rw-r--r--  2.0 unx     1226 b- defN 23-Jul-01 06:10 modal_utils/package_utils.py
+-rw-r--r--  2.0 unx      458 b- defN 23-Jul-01 06:10 modal_version/__init__.py
+-rw-r--r--  2.0 unx       48 b- defN 23-Jul-01 06:11 modal_version/_version_generated.py
+-rw-r--r--  2.0 unx    10173 b- defN 23-Jul-01 06:11 modal_client-0.49.2527.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1923 b- defN 23-Jul-01 06:11 modal_client-0.49.2527.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-01 06:11 modal_client-0.49.2527.dist-info/WHEEL
+-rw-r--r--  2.0 unx       46 b- defN 23-Jul-01 06:11 modal_client-0.49.2527.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       93 b- defN 23-Jul-01 06:11 modal_client-0.49.2527.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    13337 b- defN 23-Jul-01 06:11 modal_client-0.49.2527.dist-info/RECORD
+164 files, 1068258 bytes uncompressed, 245818 bytes compressed:  77.0%
```

## zipnote {}

```diff
@@ -468,26 +468,26 @@
 
 Filename: modal_version/__init__.py
 Comment: 
 
 Filename: modal_version/_version_generated.py
 Comment: 
 
-Filename: modal_client-0.49.2517.dist-info/LICENSE
+Filename: modal_client-0.49.2527.dist-info/LICENSE
 Comment: 
 
-Filename: modal_client-0.49.2517.dist-info/METADATA
+Filename: modal_client-0.49.2527.dist-info/METADATA
 Comment: 
 
-Filename: modal_client-0.49.2517.dist-info/WHEEL
+Filename: modal_client-0.49.2527.dist-info/WHEEL
 Comment: 
 
-Filename: modal_client-0.49.2517.dist-info/entry_points.txt
+Filename: modal_client-0.49.2527.dist-info/entry_points.txt
 Comment: 
 
-Filename: modal_client-0.49.2517.dist-info/top_level.txt
+Filename: modal_client-0.49.2527.dist-info/top_level.txt
 Comment: 
 
-Filename: modal_client-0.49.2517.dist-info/RECORD
+Filename: modal_client-0.49.2527.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## client_test/cli_test.py

```diff
@@ -268,18 +268,16 @@
 
 
 def test_serve(servicer, set_env_client, server_url_env, test_dir):
     stub_file = test_dir / "supports" / "app_run_tests" / "webhook.py"
     _run(["serve", stub_file.as_posix(), "--timeout", "3"], expected_exit_code=0)
 
 
-def test_shell(servicer, set_env_client, test_dir):
-    stub_file = test_dir / "supports" / "app_run_tests" / "default_stub.py"
-    webhook_stub_file = test_dir / "supports" / "app_run_tests" / "webhook.py"
-
+@pytest.fixture
+def mock_shell_pty():
     def mock_get_pty_info() -> api_pb2.PTYInfo:
         rows, cols = (64, 128)
         return api_pb2.PTYInfo(
             enabled=True,
             winsz_rows=rows,
             winsz_cols=cols,
             env_term=os.environ.get("TERM"),
@@ -287,40 +285,42 @@
             env_term_program=os.environ.get("TERM_PROGRAM"),
         )
 
     @asynccontextmanager
     async def noop_async_context_manager(*args, **kwargs):
         yield
 
+    with mock.patch("rich.console.Console.is_terminal", True), mock.patch(
+        "modal._pty.get_pty_info", mock_get_pty_info
+    ), mock.patch("modal._pty.write_stdin_to_pty_stream", noop_async_context_manager):
+        yield
+
+
+@pytest.mark.usefixtures("mock_shell_pty")
+def test_shell(servicer, set_env_client, test_dir):
+    stub_file = test_dir / "supports" / "app_run_tests" / "default_stub.py"
+    webhook_stub_file = test_dir / "supports" / "app_run_tests" / "webhook.py"
+
     ran_cmd = None
 
     @servicer.function_body
     def dummy_exec(cmd: str):
         nonlocal ran_cmd
         ran_cmd = cmd
 
     # Function is explicitly specified
-    with mock.patch("rich.console.Console.is_terminal", True), mock.patch(
-        "modal._pty.get_pty_info", mock_get_pty_info
-    ), mock.patch("modal._pty.write_stdin_to_pty_stream", noop_async_context_manager):
-        _run(["shell", stub_file.as_posix() + "::foo"])
+    _run(["shell", stub_file.as_posix() + "::foo"])
     assert ran_cmd == "/bin/bash"
 
     # Function is explicitly specified
-    with mock.patch("rich.console.Console.is_terminal", True), mock.patch(
-        "modal._pty.get_pty_info", mock_get_pty_info
-    ), mock.patch("modal._pty.write_stdin_to_pty_stream", noop_async_context_manager):
-        _run(["shell", webhook_stub_file.as_posix() + "::foo"])
+    _run(["shell", webhook_stub_file.as_posix() + "::foo"])
     assert ran_cmd == "/bin/bash"
 
     # Function must be inferred
-    with mock.patch("rich.console.Console.is_terminal", True), mock.patch(
-        "modal._pty.get_pty_info", mock_get_pty_info
-    ), mock.patch("modal._pty.write_stdin_to_pty_stream", noop_async_context_manager):
-        _run(["shell", webhook_stub_file.as_posix()])
+    _run(["shell", webhook_stub_file.as_posix()])
     assert ran_cmd == "/bin/bash"
 
 
 def test_app_descriptions(servicer, server_url_env, test_dir):
     stub_file = test_dir / "supports" / "app_run_tests" / "prints_desc_stub.py"
     _run(["run", "--detach", stub_file.as_posix() + "::stub.foo"])
 
@@ -357,10 +357,40 @@
         _run(["volume", "put", volume_name, upload_path, "test.txt"])
 
         _run(["volume", "get", volume_name, "test.txt", tmpdir])
         with open(os.path.join(tmpdir, "test.txt"), "r") as f:
             assert f.read() == "foo bar baz"
 
 
-def test_environment_flag(set_env_client, test_dir, servicer):
-    stub_file = test_dir / "supports" / "app_run_tests" / "default_stub.py"
-    _run(["run", "--env=staging", str(stub_file)])
+@pytest.mark.parametrize("command", [["run"], ["deploy"], ["serve", "--timeout=1"], ["shell"]])
+@pytest.mark.usefixtures("set_env_client", "mock_shell_pty")
+def test_environment_flag(test_dir, servicer, command):
+    @servicer.function_body
+    def nothing(
+        arg=None,
+    ):  # hacky - compatible with both argless modal run and interactive mode which always sends an arg...
+        pass
+
+    stub_file = test_dir / "supports" / "app_run_tests" / "app_with_lookups.py"
+    with servicer.intercept() as ctx:
+        ctx.add_response(
+            "AppLookupObject",
+            api_pb2.AppLookupObjectResponse(object_id="mo-123"),
+            request_filter=lambda req: req.app_name.startswith("modal-client-mount"),
+        )  # built-in client lookup
+        ctx.add_response(
+            "AppLookupObject",
+            api_pb2.AppLookupObjectResponse(object_id="sv-123"),
+            request_filter=lambda req: req.app_name == "volume_app",
+        )
+        _run(command + ["--env=staging", str(stub_file)])
+
+    app_create: api_pb2.AppCreateRequest = ctx.pop_request("AppCreate")
+    assert app_create.environment_name == "staging"
+
+    app_lookup_object: api_pb2.AppLookupObjectRequest = ctx.pop_request("AppLookupObject")
+    assert app_lookup_object.app_name.startswith("modal-client-mount")
+    assert app_lookup_object.namespace == api_pb2.DEPLOYMENT_NAMESPACE_GLOBAL
+
+    app_lookup_object2: api_pb2.AppLookupObjectRequest = ctx.pop_request("AppLookupObject")
+    assert app_lookup_object2.app_name == "volume_app"
+    assert app_lookup_object2.environment_name == "staging"
```

## client_test/runner_test.py

```diff
@@ -1,79 +1,70 @@
 # Copyright Modal Labs 2023
 import typing
-from typing import List, Any, Tuple
 
 import pytest
 
 import modal
 from modal.runner import run_stub
 from modal_proto import api_pb2
 
 T = typing.TypeVar("T")
 
 
-def pop_message(calls: List[Tuple[str, Any]], message_type: typing.Type[T]) -> Tuple[T, List[Tuple[str, Any]]]:
-    for i, (_, msg) in enumerate(calls):
-        if isinstance(msg, message_type):
-            return msg, calls[i + 1 :]
-
-    raise Exception("No message of that type in call list")
-
-
 def test_run_stub(servicer, client):
     dummy_stub = modal.Stub()
     with servicer.intercept() as ctx:
         with run_stub(dummy_stub, client=client):
             pass
 
-    _, remaining_calls = pop_message(ctx.calls, api_pb2.AppCreateRequest)
-    _, remaining_calls = pop_message(remaining_calls, api_pb2.AppSetObjectsRequest)
-    _, remaining_calls = pop_message(remaining_calls, api_pb2.AppClientDisconnectRequest)
+    ctx.pop_request("AppCreate")
+    ctx.pop_request("AppSetObjects")
+    ctx.pop_request("AppClientDisconnect")
 
 
 def test_run_stub_profile_env_with_refs(servicer, client, monkeypatch):
     monkeypatch.setenv("MODAL_ENVIRONMENT", "profile_env")
     with servicer.intercept() as ctx:
         dummy_stub = modal.Stub()
         dummy_stub.ref = modal.Secret.from_name("some_secret")
     assert ctx.calls == []  # all calls should be deferred
 
     with servicer.intercept() as ctx:
-        ctx.add_response("AppLookupObject", [api_pb2.AppLookupObjectResponse(object_id="st-123")])
+        ctx.add_response("AppLookupObject", api_pb2.AppLookupObjectResponse(object_id="st-123"))
         with run_stub(dummy_stub, client=client):
             pass
 
     with pytest.raises(Exception):
-        pop_message(ctx.calls, api_pb2.SecretCreateRequest)  # should not create a new secret...
+        ctx.pop_request("SecretCreate")  # should not create a new secret...
 
-    app_create, remaining_calls = pop_message(ctx.calls, api_pb2.AppCreateRequest)
+    app_create = ctx.pop_request("AppCreate")
     assert app_create.environment_name == "profile_env"
 
-    app_lookup_object, remaining_calls = pop_message(remaining_calls, api_pb2.AppLookupObjectRequest)
+    app_lookup_object = ctx.pop_request("AppLookupObject")
     assert app_lookup_object.environment_name == "profile_env"
 
 
 def test_run_stub_custom_env_with_refs(servicer, client, monkeypatch):
     monkeypatch.setenv("MODAL_ENVIRONMENT", "profile_env")
     dummy_stub = modal.Stub()
     dummy_stub.own_env_secret = modal.Secret.from_name("own_env_secret")
     dummy_stub.other_env_secret = modal.Secret.from_name(
         "other_env_secret", environment_name="third"
     )  # explicit lookup
 
     with servicer.intercept() as ctx:
-        ctx.add_response("AppLookupObject", [api_pb2.AppLookupObjectResponse(object_id="st-123")])
-        ctx.add_response("AppLookupObject", [api_pb2.AppLookupObjectResponse(object_id="st-456")])
+        ctx.add_response("AppLookupObject", api_pb2.AppLookupObjectResponse(object_id="st-123"))
+        ctx.add_response("AppLookupObject", api_pb2.AppLookupObjectResponse(object_id="st-456"))
         with run_stub(dummy_stub, client=client, environment_name="custom"):
             pass
 
     with pytest.raises(Exception):
-        pop_message(ctx.calls, api_pb2.SecretCreateRequest)
+        ctx.pop_request("SecretCreate")
 
-    app_create, remaining_calls = pop_message(ctx.calls, api_pb2.AppCreateRequest)
+    app_create = ctx.pop_request("AppCreate")
     assert app_create.environment_name == "custom"
 
-    app_lookup_object, remaining_calls = pop_message(remaining_calls, api_pb2.AppLookupObjectRequest)
+    app_lookup_object = ctx.pop_request("AppLookupObject")
     assert app_lookup_object.environment_name == "custom"
 
-    app_lookup_object, remaining_calls = pop_message(remaining_calls, api_pb2.AppLookupObjectRequest)
-    assert app_lookup_object.environment_name == "third"
+    app_lookup_object2 = ctx.pop_request("AppLookupObject")
+    assert app_lookup_object2.environment_name == "third"
```

## modal/client.pyi

```diff
@@ -11,15 +11,15 @@
 
 
 async def _grpc_exc_string(exc: grpclib.exceptions.GRPCError, method_name: str, server_url: str, timeout: float) -> str:
     ...
 
 
 class _Client:
-    def __init__(self, server_url, client_type, credentials, version='0.49.2517', *, no_verify=False):
+    def __init__(self, server_url, client_type, credentials, version='0.49.2527', *, no_verify=False):
         ...
 
     @property
     def stub(self):
         ...
 
     async def _open(self):
@@ -60,15 +60,15 @@
 
     @classmethod
     def set_env_client(cls, client):
         ...
 
 
 class Client:
-    def __init__(self, server_url, client_type, credentials, version='0.49.2517', *, no_verify=False):
+    def __init__(self, server_url, client_type, credentials, version='0.49.2527', *, no_verify=False):
         ...
 
     @property
     def stub(self):
         ...
 
     class ___open_spec(typing_extensions.Protocol):
```

## modal_utils/grpc_testing.py

```diff
@@ -1,12 +1,13 @@
 # Copyright Modal Labs 2023
 import contextlib
 import inspect
-from collections import deque, defaultdict
-from typing import Any, Optional, List, Tuple
+import logging
+from collections import defaultdict, Counter
+from typing import Any, List, Tuple, Callable, Dict
 
 from grpclib import GRPCError, Status
 
 
 def patch_mock_servicer(cls):
     """Adds an `.intercept()` context manager method
 
@@ -39,25 +40,26 @@
         raise GRPCError(Status.UNIMPLEMENTED, "Not implemented in mock servicer " + repr(cls))
 
     @contextlib.contextmanager
     def intercept(servicer):
         ctx = InterceptionContext()
         servicer.interception_context = ctx
         yield ctx
+        ctx.assert_responses_consumed()
         servicer.interception_context = None
 
     cls.intercept = intercept
     cls.interception_context = None
 
     def make_interceptable(method_name, original_method):
         async def intercepted_method(servicer_self, stream):
             ctx = servicer_self.interception_context
             if ctx:
-                intercepted_stream = InterceptedStream(ctx, method_name, stream)
-                custom_responder = ctx.next_custom_responder(method_name)
+                intercepted_stream = await InterceptedStream(ctx, method_name, stream).initialize()
+                custom_responder = ctx.next_custom_responder(method_name, intercepted_stream.request_message)
                 if custom_responder:
                     return await custom_responder(servicer_self, intercepted_stream)
                 else:
                     # use default servicer, but intercept messages for assertions
                     return await original_method(servicer_self, intercepted_stream)
             else:
                 return await original_method(servicer_self, stream)
@@ -72,53 +74,100 @@
         elif name[0].isupper() and inspect.isfunction(method):
             setattr(cls, name, make_interceptable(name, method))
 
     cls.__abstractmethods__ = frozenset()
     return cls
 
 
+class ResponseNotConsumed(Exception):
+    def __init__(self, unconsumed_requests: List[str]):
+        self.unconsumed_requests = unconsumed_requests
+        request_count = Counter(unconsumed_requests)
+        super().__init__(f"Expected but did not receive the following requests: {request_count}")
+
+
 class InterceptionContext:
     def __init__(self):
         self.calls: List[Tuple[str, Any]] = []  # List[Tuple[method_name, message]]
-        self.custom_responses: dict[str, deque[List[Any]]] = defaultdict(deque)
+        self.custom_responses: Dict[str, List[Tuple[Callable[[Any], bool], List[Any]]]] = defaultdict(list)
 
     def add_recv(self, method_name: str, msg):
         self.calls.append((method_name, msg))
 
-    def add_response(self, method_name: str, custom_response: Optional[List[Any]] = None):
-        # adds one response to a queue of responses for method method_name
-        if custom_response is not None:
-            assert isinstance(
-                custom_response, list
-            ), "custom_response should be a list of messages sent back by the servicer"
+    def add_response(
+        self, method_name: str, first_payload, *, request_filter: Callable[[Any], bool] = lambda req: True
+    ):
+        # adds one response to a queue of responses for requests of the specified type
+        self.custom_responses[method_name].append((request_filter, [first_payload]))
 
-        if custom_response:
-            self.custom_responses[method_name].append(custom_response)
-
-    def next_custom_responder(self, method_name):
+    def next_custom_responder(self, method_name, request):
         method_responses = self.custom_responses[method_name]
-        if not method_responses:
+
+        for i, (request_filter, response_messages) in enumerate(method_responses):
+            try:
+                request_matches = request_filter(request)
+            except Exception:
+                logging.exception("Error when filtering requests")
+                raise
+
+            if request_matches:
+                next_response_messages = response_messages
+                self.custom_responses[method_name] = method_responses[:i] + method_responses[i + 1 :]
+                break
+        else:
             return None
-        next_response_messages = method_responses.popleft()
 
         async def responder(servicer_self, stream):
-            await stream.recv_message()  # get the input message so we can track that
-            for msg in next_response_messages:
-                await stream.send_message(msg)
+            try:
+                await stream.recv_message()  # get the input message so we can track that
+                for msg in next_response_messages:
+                    await stream.send_message(msg)
+            except Exception:
+                logging.exception("Error when sending response")
+                raise
 
         return responder
 
+    def assert_responses_consumed(self):
+        unconsumed = []
+        for method_name, queued_responses in self.custom_responses.items():
+            unconsumed += [method_name] * len(queued_responses)
+
+        if unconsumed:
+            raise ResponseNotConsumed(unconsumed)
+
+    def pop_request(self, method_name):
+        # fast forward to the next request of type method_name
+        # dropping any preceding requests if there is a match
+        # returns the payload of the request
+        for i, (_method_name, msg) in enumerate(self.calls):
+            if _method_name == method_name:
+                self.calls = self.calls[i + 1 :]
+                return msg
+
+        raise Exception(f"No message of that type in call list: {self.calls}")
+
 
 class InterceptedStream:
     def __init__(self, interception_context, method_name, stream):
         self.interception_context = interception_context
         self.method_name = method_name
         self.stream = stream
+        self.request_message = None
+
+    async def initialize(self):
+        self.request_message = await self.recv_message()
+        return self
 
     async def recv_message(self):
+        if self.request_message:
+            ret = self.request_message
+            self.request_message = None
+            return ret
+
         msg = await self.stream.recv_message()
         self.interception_context.add_recv(self.method_name, msg)
         return msg
 
     async def send_message(self, msg):
         await self.stream.send_message(msg)
```

## modal_version/_version_generated.py

```diff
@@ -1,2 +1,2 @@
 # Copyright Modal Labs 2023
-build_number = 2517
+build_number = 2527
```

## Comparing `modal_client-0.49.2517.dist-info/LICENSE` & `modal_client-0.49.2527.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `modal_client-0.49.2517.dist-info/METADATA` & `modal_client-0.49.2527.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: modal-client
-Version: 0.49.2517
+Version: 0.49.2527
 Summary: Python client library for Modal
 Author: Modal Labs
 Author-email: erik@modal.com
 Project-URL: Homepage, https://modal.com
 Keywords: modal,client,cloud,serverless,infrastructure
 Classifier: Topic :: System :: Distributed Computing
 Classifier: Operating System :: OS Independent
```

## Comparing `modal_client-0.49.2517.dist-info/RECORD` & `modal_client-0.49.2527.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 client_test/__init__.py,sha256=waLjl5c6IPDhSsdWAm9Bji4e2PVxamYABKAze6CHVXY,28
 client_test/aio_test.py,sha256=EcUtn4yqdKeXpWb854v86k_n--grUnJA7sCoVjKsiUE,392
 client_test/async_utils_test.py,sha256=vhWOb8jRl3illb7UIVSVWnM1PeXrPADWKu8Ko4szsI8,5409
 client_test/blob_test.py,sha256=SSWnrbrpgAAmcU4txClK5ycgKuHwYTKLzO8ryVa3dyQ,1474
 client_test/cli_imports_test.py,sha256=CJYkSI0gF8Zz32xD24JWX2LSlI_jXbwQ_Osqxh80xvc,3979
-client_test/cli_test.py,sha256=4FB6RDMaSuYmYmRYDucmzqBCdnenAVbOZIy9JfQ2Z6Q,14029
+client_test/cli_test.py,sha256=C2ntM5ohioiypduD9pqvnkNucj9VEL_rdAVzbe1YwgI,15086
 client_test/client_test.py,sha256=AVDt8PzLbr5QoYUsA94jfQ8GeoQwEhT81xGUQf2uzAA,4768
 client_test/cls_test.py,sha256=yWzlN5Cnys8Cc7qZfqgKQW1Pu6iPaQ9sD7SJs7iz6O4,4422
 client_test/config_test.py,sha256=nXcFcqYZnAord4OOV1HDTGUCav0a0ga4ce80DSijR4w,2622
 client_test/conftest.py,sha256=bYC4IyHdPCR3oOow4MmdEdztQLNBovONLK7IVNpMfMg,32707
 client_test/container_app_test.py,sha256=2BmMqwseKd6ZzNUA1vzUpxqks3NusAs9CLAEgW0KEks,4555
 client_test/container_test.py,sha256=OK3AbbTRyQ0gCCw5rVpdBT4pBPyOkG1W-63xm-FwWas,24810
 client_test/cpu_test.py,sha256=CoJhxhHH9ZjZh3wnpKFfPku2Vq6xIZJoB6j7O-v2278,405
@@ -25,15 +25,15 @@
 client_test/mount_test.py,sha256=d79emlblHcv-Ey0N4jkye2roNXo_CoSRyectJadLmms,5317
 client_test/mounted_files_test.py,sha256=svuTGzOvbspbBj6twaHmCckdtpckVLpvpyCEWnAQrF0,6239
 client_test/notebook_test.py,sha256=AzzAfpXBwXvfD4zwyqAr9GW-rM0RY4aJlXKBJ3GqBp8,2157
 client_test/object_test.py,sha256=wqFoG_CoNm610KaSU5aM5PhFFFm1yk38P5aWdt7MzsU,1394
 client_test/package_utils_test.py,sha256=5BHIMwW03ettWIZ2AqFHcD8n5FIXoEcy1g2qTyqFo3Y,413
 client_test/resolver_test.py,sha256=MdK8Ewe5p2GcH195V8r1rJ-4uMs0xrYuitCqSfR6ixM,1690
 client_test/retries_test.py,sha256=Q-hNmElJjxYQ0DQ0VjEzjN7fX4wZvi3YSXS5oawjxHU,1807
-client_test/runner_test.py,sha256=2YlIJ3tGKR1t_hYp0mVOwyIwAwMMX9lR7D0LVLtSJc0,3143
+client_test/runner_test.py,sha256=yPUPq3S7Jw6oji-nMjURckRf2SiiAsbKijJ8CNoGJsQ,2428
 client_test/schedule_test.py,sha256=lyj6pHchOg_CqyJNQY8NbRUTfh-RxwAugcX5-P4b-0k,359
 client_test/secret_test.py,sha256=cCvFkKgt-0FXlSRv-Mq_6XpaJBv6gv8DoQTP4fEISCk,1185
 client_test/serialization_test.py,sha256=504YM-KzwkL7I5UlVOLB2vu_O6EByBowyH8m2vqYQR8,1086
 client_test/shared_volume_test.py,sha256=0fP4r1hCanByXR_zLiDffaFSDqHpLxksRiXhzk4DVdA,3872
 client_test/stub_test.py,sha256=j-InE65Sob2Ass3TV7fb55FCQvRpsuYbmKLIMZ5x3AM,8096
 client_test/utils_test.py,sha256=AMlrnJQfGDjy1c8mnmaNwnCmDMUh726mFx8QHSAsaDc,2691
 client_test/version_test.py,sha256=XEiHOjqHd97yuhuUiaVU22-C72XhXJXQ4wPmPJt9n08,410
@@ -59,15 +59,15 @@
 modal/_types.py,sha256=vUvweCqAt0S-mni_V_EGc_rDCKgJlU5g0P8r08zl1ko,490
 modal/_watcher.py,sha256=fTCNt2s5P-l91c6Mc9wWGbQe2CCFsPyRMNRe7GqXQ4o,3409
 modal/aio.py,sha256=drzo9s5NE5hpCS_Jv2a1NKdYKt3t25-YjlIunv3rm2M,703
 modal/app.py,sha256=0La3B3rJylLqPfQu4wv67IQ1QH_DDcP9T24ZGd6GAIQ,11467
 modal/app.pyi,sha256=keuw-AukqQQVafYWkBc7c0u1m9ghI2JbsBAToFytbr8,6300
 modal/call_graph.py,sha256=_cCMOMg7IeWNiRXdd-gJbb7pUYw2Ahl-KbXsizM6Lcg,2462
 modal/client.py,sha256=5SP2hnkap1_8ZZ_eu-DmhM3V24FP8X1Ew9XQNxyZ7EM,9162
-modal/client.pyi,sha256=KD1DHrkMa6tZYyY3cn63PXyAs85PrXvxYxSOlmbg9Ug,3429
+modal/client.pyi,sha256=KBtzVdDfi1rUprgDpIDhxNEt6NmGiyL7vNRzuopcnQQ,3429
 modal/cls.py,sha256=O9qHequfOgR2HTwPfLYPK_3v8J4Ir0iByW0_hO0CYiM,1737
 modal/config.py,sha256=PiJtJ0LEdL_QBEUGncbfYhHy8CJlstmH9Xh7n7ZIhFM,7149
 modal/dict.py,sha256=PEjV5C3N0d2_Ky-sYCznSdpnMSfdGy0fuVH01oeaR18,5962
 modal/dict.pyi,sha256=32GJbstdhQVz53hnLalD6E3aLQAKnEjVEZ7uzYIZYOc,3538
 modal/exception.py,sha256=gxHMYe7CiH1ijgGyiPe-KAxJOVkUquIMPgrOc-QIdSc,2750
 modal/functions.py,sha256=AX3A008piWQydRTw3dLO_ZreGY7xbbU1O0nTnObsgbc,60540
 modal/functions.pyi,sha256=foGMzoxcl6H1YYTxTKhA4YwR1UZRdZpFgbDbxJLdOt4,17872
@@ -144,21 +144,21 @@
 modal_test_support/startup_failure.py,sha256=gWwHoB78_96RJHuFaEVhCg01trgSaDD67w6m50umyoc,178
 modal_test_support/stub.py,sha256=RJj_CM-KqucBkqszzTuBimp670tjOmHUm76GmAAF54A,177
 modal_test_support/unconsumed_map.py,sha256=UOPhJz4d87sQ3ngsbaJWDDTTF_SSYgpidTOMgQ2aac8,144
 modal_test_support/webhook_forgot_function.py,sha256=Ncfi8G1C76FqWFoCzjn2TjXEmQ6Ad-u9ewjuVN3wOxQ,123
 modal_utils/__init__.py,sha256=waLjl5c6IPDhSsdWAm9Bji4e2PVxamYABKAze6CHVXY,28
 modal_utils/app_utils.py,sha256=Uf9oNKcC6wJg3wcHNygWxMlkXuIMVRYIE5nutDSafkQ,465
 modal_utils/async_utils.py,sha256=wWCT99q-Ty72Yr3WT0-6nsYmSj56KRJ3kE8QVpEjtMQ,11060
-modal_utils/grpc_testing.py,sha256=EXTXGa2Kg_IjElWFn-5nK-rhjslG9LTQkIkvZbEr4ko,4641
+modal_utils/grpc_testing.py,sha256=kdcS5-Y9KQIck9egO1k5c90wcj_JmOTAblYHvXnIfHM,6538
 modal_utils/grpc_utils.py,sha256=nvoS4UwH3t2sH13Nnd9VRrG7FFpCcBbacU6PX8rM_KA,9320
 modal_utils/hash_utils.py,sha256=YOE1LZwyqaTQSZajrF-H_5_iJkjxMclJewC0SgH_8xA,1597
 modal_utils/http_utils.py,sha256=DGKvrSQxAHjP_LNdM6EaL-TIQPGDX5vt3gcMGg2xkz4,1426
 modal_utils/logger.py,sha256=odPE0R8_9GkufC_74wqolLikZVIbdxmwDF5xeoILklU,113
 modal_utils/package_utils.py,sha256=TLF7GygWqsqZpL-dVnchts55IcTwkMPFLBGeZjuRXCw,1226
 modal_version/__init__.py,sha256=mvujZot4MZ2ZzvN-QWqUcdJ-AG3rsuVzC_r7Jfwzh4E,458
-modal_version/_version_generated.py,sha256=fzs96_StpYz213nPWztDiBJ7qEPfE5iKkKocq0csjr0,48
-modal_client-0.49.2517.dist-info/LICENSE,sha256=psuoW8kuDP96RQsdhzwOqi6fyWv0ct8CR6Jr7He_P_k,10173
-modal_client-0.49.2517.dist-info/METADATA,sha256=7kR7KPoLidTe49NFDgFwMLbf0RbVq9gAPFfJ0CB_-mI,1923
-modal_client-0.49.2517.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-modal_client-0.49.2517.dist-info/entry_points.txt,sha256=An-wYgeEUnm6xzrAP9_NTSTSciYvvEWsMZILtYrvpAI,46
-modal_client-0.49.2517.dist-info/top_level.txt,sha256=vTBZ60jGY6Z2jEeHlo3uEJRmrR3M1rZoXur0ZaqOrS4,93
-modal_client-0.49.2517.dist-info/RECORD,,
+modal_version/_version_generated.py,sha256=Lu_U9NF40-4x-iMRBF4g7DPrELpb_8IfJ5V789VvA0Q,48
+modal_client-0.49.2527.dist-info/LICENSE,sha256=psuoW8kuDP96RQsdhzwOqi6fyWv0ct8CR6Jr7He_P_k,10173
+modal_client-0.49.2527.dist-info/METADATA,sha256=r45xK3XI6MLGm1zT1Mj_J8lsyxsKtzcLaqxTpJ3LLzc,1923
+modal_client-0.49.2527.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+modal_client-0.49.2527.dist-info/entry_points.txt,sha256=An-wYgeEUnm6xzrAP9_NTSTSciYvvEWsMZILtYrvpAI,46
+modal_client-0.49.2527.dist-info/top_level.txt,sha256=vTBZ60jGY6Z2jEeHlo3uEJRmrR3M1rZoXur0ZaqOrS4,93
+modal_client-0.49.2527.dist-info/RECORD,,
```

